create database stats_db;

create table kpi_daily_report (
	id int auto_increment,
	game_type varchar(10)	/* pc or mobile*/,
	game_code varchar(20),
	log_date varchar(20),
	calculated_by varchar(20) COMMENT 'Calculated method: timing (daily, weekly, monthly), kpi (a1, a7, a30).',
	calculated_id varchar(20) COMMENT 'Unique id using to determine an user on game',
	created_date datetime COMMENT 'The day that report is calculated, different from log_date',
	created_by varchar(20) COMMENT 'Report is generated by this value (spark, mapreduce, pig,...)',
	pcu_ip bigint,
	pcu_db bigint,
	acu_ip bigint,
	acu_db bigint,
	dau_acc_a1 bigint,
	dau_role_a1 bigint,
	wau_acc_a7 bigint,
	wau_role_a7 bigint,
	mau_acc_a30 bigint,
	mau_role_a30 bigint,
	nru_acc_a1 bigint,
	nru_role_a1 bigint,
	nru_acc_a7 bigint,
	nru_role_a7 bigint,
	nru_acc_a30 bigint,
	nru_role_a30 bigint,
	retention_a1 bigint,
	retention_a7 bigint,
	retention_a30 bigint,
	churn_a1 bigint,
	churn_a7 bigint,
	churn_a30 bigint,
	gross_revenue_gr1 bigint,
	gross_revenue_gr7 bigint,
	gross_revenue_gr30 bigint,
	paying_user_pu1 bigint,
	paying_user_pu7 bigint,
	paying_user_pu30 bigint,
	nru1 bigint COMMENT 'User that play game for the first time or playing game after 30 days churn',
	ngr_1 bigint,
	nrp1 bigint COMMENT 'New register user on day 1 that paid on day 1',
	nrp3 bigint COMMENT 'New register user on day 1 that paid on day 3',
	rr2 double,
	rr7 double,
	primary key (id),
	key unique_index (game_type, game_code, log_date, calculated_by, calculated_id)
);